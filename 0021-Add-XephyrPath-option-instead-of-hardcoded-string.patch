From 68c89e7eab9e9cf69785c05fce2591298ac30741 Mon Sep 17 00:00:00 2001
From: Nikolay Amiantov <ab@fmap.me>
Date: Mon, 2 Mar 2015 20:53:35 +0300
Subject: [PATCH 21/24] Add XephyrPath option instead of hardcoded string

---
 data/man/sddm.conf.rst.in        | 4 ++++
 src/common/Configuration.h       | 1 +
 src/daemon/XorgDisplayServer.cpp | 2 +-
 3 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/data/man/sddm.conf.rst.in b/data/man/sddm.conf.rst.in
index 39182df..7ea896c 100644
--- a/data/man/sddm.conf.rst.in
+++ b/data/man/sddm.conf.rst.in
@@ -65,6 +65,10 @@ OPTIONS
 	Path of the X server.
 	Default value is "/usr/bin/X".
 
+`XephyrPath=`
+	Path of the Xephyr.
+	Default value is "/usr/bin/Xephyr".
+
 `XauthPath=`
 	Path of the Xauth.
 	Default value is "/usr/bin/xauth".
diff --git a/src/common/Configuration.h b/src/common/Configuration.h
index 72aa6f4..854cc22 100644
--- a/src/common/Configuration.h
+++ b/src/common/Configuration.h
@@ -54,6 +54,7 @@ namespace SDDM {
         // TODO: Not absolutely sure if everything belongs here. Xsessions, VT and probably some more seem universal
         Section(XDisplay,
             Entry(ServerPath,          QString,     _S("/usr/bin/X"),                           _S("X server path"));
+            Entry(XephyrPath,          QString,     _S("/usr/bin/Xephyr"),                      _S("Xephyr path"));
             Entry(XauthPath,           QString,     _S("/usr/bin/xauth"),                       _S("Xauth path"));
             Entry(SessionDir,          QString,     _S("/usr/share/xsessions"),                 _S("Session description directory"));
             Entry(SessionCommand,      QString,     _S(SESSION_COMMAND),                        _S("Xsession script path\n"
diff --git a/src/daemon/XorgDisplayServer.cpp b/src/daemon/XorgDisplayServer.cpp
index a9c783c..7eb7847 100644
--- a/src/daemon/XorgDisplayServer.cpp
+++ b/src/daemon/XorgDisplayServer.cpp
@@ -132,7 +132,7 @@ namespace SDDM {
         if (daemonApp->testing()) {
             QStringList args;
             args << m_display << "-ac" << "-br" << "-noreset" << "-screen" << "800x600";
-            process->start("/usr/bin/Xephyr", args);
+            process->start(mainConfig.XDisplay.XephyrPath.get(), args);
 
 
             // wait for display server to start
-- 
1.9.0

