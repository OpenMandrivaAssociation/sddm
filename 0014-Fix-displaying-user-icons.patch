From 8a929e0b27b617f00809131dac87e5d149a86fea Mon Sep 17 00:00:00 2001
From: David Rosca <nowrep@gmail.com>
Date: Mon, 19 Jul 2021 20:02:50 +0200
Subject: [PATCH] Fix displaying user icons

Regression from d34be784b2
---
 src/greeter/UserModel.cpp | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/greeter/UserModel.cpp b/src/greeter/UserModel.cpp
index 6bc25e8..5b92df5 100644
--- a/src/greeter/UserModel.cpp
+++ b/src/greeter/UserModel.cpp
@@ -138,14 +138,18 @@ namespace SDDM {
                 const QString systemFace = QStringLiteral("%1/%2.face.icon").arg(facesDir).arg(user->name);
                 const QString accountsServiceFace = QStringLiteral("/var/lib/AccountsService/icons/%1").arg(user->name);
 
+                QString userIcon;
                 // If the home is encrypted it takes a lot of time to open
                 // up the greeter, therefore we try the system avatar first
                 if (QFile::exists(systemFace))
-                    user->icon = systemFace;
+                    userIcon = systemFace;
                 else if (QFile::exists(userFace))
-                    user->icon = userFace;
+                    userIcon = userFace;
                 else if (QFile::exists(accountsServiceFace))
-                    user->icon = accountsServiceFace;
+                    userIcon = accountsServiceFace;
+
+                if (!userIcon.isEmpty())
+                    user->icon = QStringLiteral("file://%1").arg(userIcon);
             }
         }
     }
-- 
2.33.0

