From fc24321541f6f65b7d1aac89cd82336ffd53e1a0 Mon Sep 17 00:00:00 2001
From: Harald Sitter <sitter@kde.org>
Date: Mon, 24 Oct 2022 13:15:48 +0200
Subject: [PATCH] disable automatic portal launching

in Qt6 (and the KDE patch collection for Qt 5) genericunixservices will
internally attempt to probe the portal tech early on in the app life
cycle. this causes the protal system to launch app and then crash
because we aren't actually providing a fully functional session. instead
opt out of this altogether
---
 src/greeter/GreeterApp.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/greeter/GreeterApp.cpp b/src/greeter/GreeterApp.cpp
index f2ef4cff..0e7e80f9 100644
--- a/src/greeter/GreeterApp.cpp
+++ b/src/greeter/GreeterApp.cpp
@@ -349,6 +349,8 @@ int main(int argc, char **argv)
     // crash handler which we don't want counterintuitively setting this env
     // disables that handler
     qputenv("KDE_DEBUG", "1");
+    // Qt internally may load the xdg portal system early on, prevent this, we do not have a functional session running.
+    qputenv("QT_NO_XDG_DESKTOP_PORTAL", "1");
 
     // Qt IM module
     if (!SDDM::mainConfig.InputMethod.get().isEmpty())
